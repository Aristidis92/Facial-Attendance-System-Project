{% extends 'base.html' %}
{% block content %}
<h2>Admin Dashboard</h2>

<div style="display: flex; flex-wrap: wrap; gap: 20px;">
  <!-- Quick Stats Section -->
  <div style="flex: 1; background: #e9f5ff; padding: 20px; border-radius: 8px;">
    <h3>Quick Statistics</h3>
    <div style="margin-bottom: 15px;">
      <strong>Total Units:</strong> {{ total_units }}
    </div>
    <div style="margin-bottom: 15px;">
      <strong>Total Teachers:</strong> {{ total_teachers }}
    </div>
    <div style="margin-bottom: 15px;">
      <strong>Total Students:</strong> {{ total_students }}
    </div>
  </div>

  <!-- Management Links -->
  <div style="flex: 1; background: #fff7e6; padding: 20px; border-radius: 8px;">
    <h3>Management</h3>
    <p><a href="{% url 'manage_users' %}">Manage Users</a></p>
    <p><a href="{% url 'manage_units' %}">Manage Units</a></p>
  </div>
</div>

<!-- Units Overview Section -->
<div style="margin-top: 30px;">
  <h3>Units Overview</h3>
  <div class="table-responsive">
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
      <thead>
        <tr style="background-color: #f5f5f5;">
          <th style="padding: 12px; border: 1px solid #ddd;">Unit Code</th>
          <th style="padding: 12px; border: 1px solid #ddd;">Unit Name</th>
          <th style="padding: 12px; border: 1px solid #ddd;">Teacher</th>
          <th style="padding: 12px; border: 1px solid #ddd;">Enrolled Students</th>
          <th style="padding: 12px; border: 1px solid #ddd;">Active Session</th>
          <th style="padding: 12px; border: 1px solid #ddd;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for unit in units %}
        <tr>
          <td style="padding: 12px; border: 1px solid #ddd;">{{ unit.code }}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">{{ unit.name }}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">{{ unit.teacher.username }}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">{{ unit.students.count }}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">
            {% if unit.has_active_session %}
              <span style="color: green;">Active</span>
            {% else %}
              <span style="color: red;">Inactive</span>
            {% endif %}
          </td>
          <td style="padding: 12px; border: 1px solid #ddd;">
            
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" style="padding: 12px; text-align: center;">No units available</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Recent Attendance Section -->
<div style="margin-top: 30px; margin-bottom: 30px;">
  <h3>Recent Attendance</h3>
  <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px;">
    <div style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <div class="table-responsive">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="padding: 8px; border: 1px solid #ddd;">Unit</th>
              <th style="padding: 8px; border: 1px solid #ddd;">Date</th>
              <th style="padding: 8px; border: 1px solid #ddd;">Present</th>
              <th style="padding: 8px; border: 1px solid #ddd;">Absent</th>
              <th style="padding: 8px; border: 1px solid #ddd;">Attendance Rate</th>
            </tr>
          </thead>
          <tbody>
            {% for attendance_data in recent_attendance %}
            <tr>
              <td style="padding: 8px; border: 1px solid #ddd;">{{ attendance_data.unit__code }} - {{ attendance_data.unit__name }}</td>
              <td style="padding: 8px; border: 1px solid #ddd;">{{ attendance_data.date }}</td>
              <td style="padding: 8px; border: 1px solid #ddd;">{{ attendance_data.present_count }}</td>
              <td style="padding: 8px; border: 1px solid #ddd;">{{ attendance_data.absent_count }}</td>
              <td style="padding: 8px; border: 1px solid #ddd;">
                {{ attendance_data.attendance_rate|floatformat:1 }}%
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" style="padding: 8px; text-align: center;">No recent attendance data</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock %}